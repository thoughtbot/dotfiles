#!/usr/bin/env ruby
#
# Interact with the production environment on Heroku.
#
# production backup
# production console
# production migrate
# production tail
#
# The script also acts as a pass-through, so you can do anything with it that
# you can do with `heroku ______ -r production`:
#
# production open
# watch production ps

class Production
  def initialize(subcommands)
    @subcommands = subcommands
    @subcommand = @subcommands.first
  end

  def run
    case @subcommand
    when 'backup'
      system 'heroku pgbackups:capture --expire -r production'
    when 'console'
      system 'heroku run console -r production'
    when 'migrate'
      system 'heroku run rake db:migrate -r production && heroku restart -r production'
    when 'tail'
      system 'heroku logs --tail -r production'
    else
      system "heroku #{@subcommands.join(' ')} -r production"
    end
  end
end

production = Production.new(ARGV)
production.run
